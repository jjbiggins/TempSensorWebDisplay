import Linedataset from'./line';import{pluckNumber,pluck,getFirstValue,toRaphaelColor,preDefStr}from'../lib/lib';import{addDep}from'../dependency-manager';import boxandwhiskerlineAnimation from'../animation-rules/boxandwhiskerline-animation';let UNDEF,POLYGON=preDefStr.POLYGON,SPOKE=preDefStr.SPOKE,BOLDSTARTTAG='<b>',BOLDENDTAG='</b>',createGroup=function(a,b,c){var d=c.getFromEnv('animationManager');return d.setAnimation({el:'group',attr:a,container:b,component:c,label:'group'})};addDep({name:'boxandwhiskerlineAnimation',type:'animationRule',extension:boxandwhiskerlineAnimation});class BoxAndWhiskerLinedataset extends Linedataset{getName(){return'boxandwhiskerline'}createCoordinates(){var a,b,c,d,e,f=this,g=f.components,h=g.data,j=f.getFromEnv('yAxis'),k=f.getFromEnv('xAxis'),l=h.length,m=f.components,n=m.data,o=f.getFromEnv('columnXShift'),p=f.getFromEnv('columnWidth');for(c=0;c<l;c++)(a=n[c],b=a&&a.config,a!==UNDEF)&&(d=k.getPixel(b._x),e=j.getPixel(b._y),b._Px=d+o+p/2,b._Py=e)}getAllPlots(a,b){let c,d,e=this.components.data,f=[];for(c=0,d=e.length;c<d;c++)(e[c].config._x>=a||e[c].config._x<=b)&&f.push(e[c]);return f}calculateScrollRange(){let a=this,b=a.config,c=a.components.data;b.scrollMinVal=0,b.scrollMaxVal=c.length,b.scrollMinValForLabel=b.scrollMinVal,b.scrollMaxValForLabel=b.scrollMaxVal}_getHoveredPlot(a,b){var c,d,e,f,g,h,i=this,k=i.getFromEnv('xAxis'),l=i.components,m=l.data,n=m.length,o=i.config,p=o&&o.radius||0;for(a+=k.getTranslation(),d=Math.floor(Math.max(k.getValue(a-p),0)),e=Math.ceil(Math.min(k.getValue(a+p),n-1)),h=i.getAllPlots(d,e),g=h.length;0<=g&&(c=h[g],!(c&&(f=i.isWithinShape(c,g,a,b),f)));g--);return f}_addLegend(a){if(a){var b,c,d=this,e=d.getFromEnv('chart'),f=d.config,g=e.getChildren('legend')[0],h=pluckNumber(f.drawanchors,1);f.includeinlegend?(c={anchorSide:h?f.anchorsides:0,label:getFirstValue(f.JSONData.seriesname),customLegendIcon:!1,spoke:'spoke'===f.dip?1:0,drawLine:!f.showline,index:d.getJSONIndex()},b=g.getItem(d.config.legendItemId),!b&&(d.config.legendItemId=g.createItem(d),b=g.getItem(d.config.legendItemId),d.addExtEventListener('click',function(){b.itemClickFn()},b)),b.configure(c),b.setStateCosmetics('default',{symbol:{fill:toRaphaelColor({color:f.anchorbgcolor,alpha:f.anchorbgalpha}),rawFillColor:f.anchorbgcolor,stroke:toRaphaelColor({color:f.anchorbordercolor,alpha:'100'})},background:{legendBackgroundColor:toRaphaelColor(d.getFromEnv('legendBackgroundColor')),alpha:20}}),d.getState('visible')?b.removeLegendState('hidden'):b.setLegendState('hidden')):d.config.legendItemId&&g.disposeItem(d.config.legendItemId)}}configureAttributes(a){super.configureAttributes(a);var b=this,c=b.config.JSONData,d=b.config;b.setState('visible',b.getLinkedParent().getState('visible')),d.skipCommonElements=c.showline,d.dip=c.dip}createContainer(){var a,b,c=this,d=c.getType(),e=c.groupName,f=c.getLinkedParent().getLinkedParent(),g=e||c.dsGroup||d;f.getChildContainer(g+'VcanvasGroup')||(g='default'),a=f.getChildContainer('manager-defaultVcanvasGroup-lines'),b=f.getChildContainer(g+'ShadowVcanvasGroup'),c.getContainer('shadowGroup')||c.addContainer('shadowGroup',createGroup({name:'shadow-group'},b,c)),c.getContainer('commonElemsGroup')||c.addContainer('commonElemsGroup',createGroup({name:'common-elems-group'},a,c)),c.getContainer('plotGroup')||c.addContainer('plotGroup',createGroup({name:'common-elems-group'},a,c)),c.getContainer('labelGroup')||c.addContainer('labelGroup',createGroup({name:'label-group',class:'fusioncharts-datalabels',opacity:1},f.getChildContainer('vcanvasLabelGroup'),c))}_setConfigure(a,b){super._setConfigure(a,b);var c,d,e,f,g,h,j=this,k=j.getFromEnv('chartConfig'),l=j.config.JSONData,m=a||l.data||[],n=m.length,o=j.components.data;for(f=0;f<n;f++)a?(c=a&&a.data[f]||{},b===UNDEF?(g=o.length-n+f,d=o[g]):(g=b+f,d=o[g])):(d=o[f],c=m&&m[f]||{}),e=d&&d.config,h=pluck(c.dip,l.dip),e.dip=h===POLYGON?0:h===SPOKE?1:0,e.toolText=e.finalTooltext=BOLDSTARTTAG+l.seriesname+k.tooltipsepchar+BOLDENDTAG+e.displayValue}}export default BoxAndWhiskerLinedataset;