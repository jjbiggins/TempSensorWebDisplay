import AreaDataset from'./area';import{hasSVG,getMouseCoordinate,pluck,pluckNumber,getValidValue,parseUnsafeString,parseTooltext,polyPathToPath}from'../lib/lib';import{_restore,_getJSONData,updateDataValue}from'./dragcolumn';import dragAreaAnimation from'../animation-rules/dragArea-animation';import{addDep}from'../dependency-manager';let _updateImage,_configure,__firePlotEvent,UNDEF,SETROLLOVERATTR='setRolloverAttr',SETROLLOUTATTR='setRolloutAttr',ROLLOUT='DataPlotRollOut',ROLLOVER='DataPlotRollOver',DRAGLINE='dragLine',DATAPLOTCLICK='dataplotclick',mathMin=Math.min,mathMax=Math.max,isVML=!1;addDep({name:'dragAreaAnimation',type:'animationRule',extension:dragAreaAnimation});class DragAreaDataset extends AreaDataset{getType(){return'dataset'}getName(){return'dragArea'}configureAttributes(a){var b=this,c=b.config,d=b.getFromEnv('chart-attrib'),e=c.JSONData;c.allowDrag=pluckNumber(e.allowdrag,1),c.allowNegDrag=pluckNumber(e.allownegativedrag,1),c.allowAxisChange=pluckNumber(d.allowaxischange,1),c.snapToDivOnly=pluckNumber(d.snaptodivonly,0),c.doNotSnap=pluckNumber(d.donotsnap,0),c.snapToDiv=pluckNumber(d.snaptodiv,1),c.snapToDivRelaxation=pluckNumber(d.snaptodivrelaxation,10),c.doNotSnap&&(c.snapToDiv=c.snapToDivOnly=0),super.configureAttributes(a)}_plotConfigure(a,b){let c,d,e=this.config,f=this.components.data;super._plotConfigure(a,b),c=f[a],d=c.config,d.allowDrag=pluckNumber(b.allowdrag,e.allowDrag),d.allowNegDrag=pluckNumber(b.allownegativedrag,e.allowNegDrag)}static updateImage(a){var b,c=a.graphics,d=c.image||c.element,e=a.config,f=e.anchorProps,g=e.hoverEffects,h=d&&d.data('imgRef'),i=f.imageScale,j=.01*(h.height*i),k=.01*(h.width*i),l=a._xPos,m=a._yPos,n=g.imageHoverScale,o=.01*(h.width*n),p=.01*(h.height*n),q=f.isAnchorRadius,r=f.radius=q?f.radius:mathMin(k,j)/2,s=f.imagePadding,t=r-s-.5*f.borderThickness,u=g.radius-s-.5*g.anchorBorderThickness,v=f.symbol[1],w=polyPathToPath([v||2,l,m,0<u?u:0,g.startAngle,g.dip]),x=polyPathToPath([v||2,l,m,0<t?t:0,f.startAngle,0]),y={x:l-.005*(h.width*i),y:m-.005*(h.height*i),width:k,height:j,alpha:100};y['clip-path']=x,b={x:l-.005*(h.width*n),y:m-.005*(h.height*n),width:o,height:p,alpha:100},b['clip-path']=w,d.attr(y),d.data(SETROLLOVERATTR,b),d.data(SETROLLOUTATTR,y)}_firePlotEvent(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=this,N=M.config,O=M.getFromEnv('chart-attrib'),P=M.getFromEnv('chart'),Q=M.getFromEnv('chartConfig'),R=Q.drawTrendRegion,S=N.JSONData,T=document,U=M.getFromEnv('paper'),V=M.getFromEnv('toolTipController'),W=U.canvas,X=W.style,Y=M.getFromEnv('number-formatter'),Z=M.components,$=Z.data[b],_=N.currentToolTip,aa=N.index,ba=c.originalEvent,ca=hasSVG&&'ns-resize'||'n-resize',da=M.getFromEnv('yAxis'),ea=da.yBasePos,fa=[1,2,3,4,5,6,7],ga=Q.yaxisname,ha=Q.xaxisname,ia={xaxisName:ha,yaxisName:ga},ja=Q.canvasTop,ka=Q.canvasBottom,la=M.getGraphicalElement(),ma=la.lineElement,na=C?ka:ea,oa=M.getName()===DRAGLINE;'touchend'===a&&(z=ba.changedTouches[0],ba.pageX=z&&z.pageX,ba.pageY=z&&z.pageY),j=getMouseCoordinate(P.getFromEnv('chart-container'),ba),k=j.chartY,l=j.chartX;$&&(r=$.graphics.element,x=$.config,H=x.hoverEffects,D=x.anchorProps,E=D.imageUrl,G=$.graphics.image,F=r,L=x.hoverEffects&&x.hoverEffects.enabled,I=D.startAngle||90,t=getValidValue(parseUnsafeString(pluck(S.data[b].tooltext,S.plottooltext,O.plottooltext))),u=x.finalTooltext,s=x.hoverEffects.enabled,v=x.eventArgs,m=$._yPos,n=$._xPos,B=x.allowDrag,C=x.allowNegDrag,na=C?ka:ea,x.dragTolerance=x.dragTolerance<D.markerRadius?D.markerRadius+.5:x.dragTolerance,i=mathMax(x.dragTolerance,x.hoverEffects.anchorRadius||0)+1,'mouseover'===a?(N.mouseIn=!0,x.allowDrag&&(X.cursor=ca),x.dragStart||!u||x.dragStart||R||(_?V.draw(ba,u,_):_=N.currentToolTip=V.draw(ba,u)),x.dragStart||(s&&M._hoverPlotAnchor($,ROLLOVER),r&&P.plotEventHandler(r,c,ROLLOVER,v))):'mouseout'===a?(N.mouseIn=!1,X.cursor='default',s&&M._hoverPlotAnchor($,ROLLOUT),r&&P.plotEventHandler(r,c,ROLLOUT,v),V.hide(N.currentToolTip)):'touchmove'===a||'mousemove'===a?!x.dragStart&&u&&k>=m-i&&k<=m+i&&l<=n+i&&l>=n-i?(x.allowDrag&&(X.cursor=ca),_?V.draw(ba,u,_):_=N.currentToolTip=V.draw(ba,u)):V.hide(N.currentToolTip):'click'===a?!x.dragMove&&r&&P.plotEventHandler(r,c,DATAPLOTCLICK,v):'touchstart'===a||'mousedown'===a?(d=function(a,c){k=getMouseCoordinate(M.getFromEnv('chart-container'),a).chartY,ba.preventDefault?ba.preventDefault():ba.returnValue=!1,x.allowDrag&&(X.cursor=ca),x.dragMove=!0,x._pointerDy++,k+=x._dragBuffer,k<ja?k=ja:k>na&&(k=na),$._yPos=m=k,x._y=A=x.setValue=da.getValue(m),x._Py=da.getPixel(x._y),y=Y.dataLabels(A),x.toolTipValue=y,x.displayValue=y,M.parseLabelAttributes($,b),M.drawLabel(b,b+1),$.graphics.element=r,(L&&(J=F.data(SETROLLOVERATTR))&&(J.path=polyPathToPath([H.anchorSides||2,$._xPos,$._yPos,H.anchorRadius,H.startAngle,H.dip])),L&&(K=F.data(SETROLLOUTATTR))&&(K.path=polyPathToPath([D.symbol[1]||2,$._xPos,$._yPos,D.radius,D.startAngle,x.dip||0])),F&&F.attr(K||{path:polyPathToPath([D.symbol[1]||2,n,$._yPos,D.radius,I,0])})),G&&DragAreaDataset.updateImage($),h=Z.data,oa&&M.drawCommonElements(),c&&(N=M.config,p=x.pathStartIndex,q=x.pathEndIndex,o=x.lastPath,o=M.getLinePath(h,{begin:p,end:q}),c.attr({path:o.getPathArr()})),1===x._pointerDy&&(v={dataIndex:b,datasetIndex:aa,startValue:$.startValue,endValue:x.setValue,datasetName:$.name},P.fireChartInstanceEvent('dataplotDragStart',v))},e=function(a){k=getMouseCoordinate(M.getFromEnv('chart-container'),a).chartY,N.mousedown=!1,x.dragStart&&(M.setMaxMin($),v={dataIndex:b,datasetIndex:aa,startValue:$.startValue,endValue:x.setValue,datasetName:$.name},w=[P.getFromEnv('chartInstance').id,v.dataIndex,v.datasetIndex,v.datasetName,v.startValue,v.endValue],r&&updateDataValue.call(r,c,P),x._pointerDy&&(s&&M._hoverPlotAnchor($,ROLLOUT),P.fireChartInstanceEvent('dataplotDragEnd',v),P.fireChartInstanceEvent('chartupdated',v,w))),t!==UNDEF&&(ia.formattedValue=x.toolTipValue,ia.label=x.label,u=parseTooltext(t,fa,ia,{value:x.toolTipValue},UNDEF,S),x.setTooltext=u,t=u,x.toolText=u),u=x.finalTooltext=!1===x.toolText?'':t||x.toolText.substring(0,x.toolText.indexOf(x.formatedVal))+x.toolTipValue,k>=m-i&&k<=m+i&&l<=n+i&&l>=n-i||(X.cursor='default'),x._dragBuffer=0,x._pointerDy=0,x.dragStart=!1,T.removeEventListener?(T.removeEventListener('mousemove',f),T.removeEventListener('mouseup',g),T.removeEventListener('touchmove',f),T.removeEventListener('touchend',g)):(T.detachEvent('onmousemove',f),T.detachEvent('onmouseup',g),T.detachEvent('ontouchmove',f),T.detachEvent('ontouchend',g))},N.mousedown=!0,x.dragMove=!1,B&&k>=m-i&&k<=m+i&&l<=n+i&&l>=n-i?(x.dragStart=!0,x._pointerDy=0,x._dragStartY=k,x._dragBuffer=m-k,$.dragged=!0,$.startValue=x.setValue,$.name=N.seriesname,$.datasetIndex=N.index,v={dataIndex:b+1,datasetIndex:$.datasetIndex,startValue:$.startValue,datasetName:$.name},f=function(a){d(a,ma)},g=function(a){e(a)},T.addEventListener?(T.addEventListener('mousemove',f),T.addEventListener('touchmove',f),T.addEventListener('mouseup',g),T.addEventListener('touchend',g)):(T.attachEvent('onmousemove',f),T.attachEvent('ontouchmove',f),T.attachEvent('onmouseup',g),T.attachEvent('ontouchend',g))):x.dragStart=!1):void 0)}restore(){_restore.call(this)}getJSONData(){return _getJSONData.call(this)}}_updateImage=DragAreaDataset.prototype.updateImage,__firePlotEvent=DragAreaDataset.prototype._firePlotEvent,_configure=DragAreaDataset.prototype.configureAttributes;export{__firePlotEvent,_configure as configurer,_updateImage};export default DragAreaDataset;