import ComponentInterface from'../../core/component-interface';import domEvtHandler from'../dom/dom-event';import{getMouseCoordinate,isIE11,UNDEF}from'../lib/lib';var MOUSEOVER='mouseover',MOUSEDOWN='mousedown',TOUCHSTART='touchstart',MOUSEUP='mouseup',TOUCHEND='touchend',MOUSEMOVE='mousemove',TOUCHMOVE='touchmove',MOUSEOUT='mouseout',CLICK='click',win=window,doc=win.document,hasTouch='ontouchstart'in win;class MouseTracker extends ComponentInterface{constructor(){super(),this.pIndex=1,this.handler=function(a){return function(b){a.config.lastTouchStartEvent=b.originalEvent,b.originalEvent&&a.getFromEnv('chart')._mouseEvtHandler(b,a.config.evtData)}}(this),this.globalHandler=function(a){return function(b){var c,d,e=a.getFromEnv('chart');(b.type===TOUCHSTART||b.type===MOUSEDOWN)&&(c=e.getChildren('canvas')[0],d=getMouseCoordinate(a.getFromEnv('chart-container'),b.originalEvent,e),a.config.lastTouchStartEvent===b.originalEvent||c&&c.isWithinCanvas(d.chartX,d.chartY))||(b.originalEvent&&e._mouseEvtHandler(b,a.config.evtData),a._removeDocEvents(),a.globalHandlerAttached=!1)}}(this),this.eventsList=[MOUSEDOWN,TOUCHSTART,MOUSEUP,TOUCHEND,MOUSEMOVE,TOUCHMOVE,CLICK,MOUSEOVER],this.config={},this.config.evtData={}}getMouseEvents(a,b,c){var d=this,e=d._lastDatasetIndex,f=d._lastPointIndex,g=a.type,h={fireOut:!1,events:[]};if(d.hasTouchEvent&&(g===MOUSEDOWN||g===MOUSEOUT))return h;switch(g){case CLICK:h.events.push(CLICK);break;case TOUCHMOVE:case MOUSEMOVE:e===b&&f===c?(clearTimeout(d.mouseoutTimer),h.events.push(MOUSEMOVE)):(h.events.push(MOUSEOVER),h.fireOut=!0);break;case TOUCHSTART:d.hasTouchEvent=!0;case MOUSEDOWN:d.globalHandlerAttached||(d.globalHandlerAttached=!0,hasTouch?d.eventOutput=domEvtHandler.listen(doc,TOUCHSTART,d.globalHandler):isIE11&&(d.eventOutput=domEvtHandler.listen(doc,MOUSEDOWN,d.globalHandler))),e!==b||f!==c?(h.fireOut=!0,h.events.push(MOUSEOVER)):hasTouch&&h.events.push(MOUSEMOVE),h.events.push(MOUSEDOWN);break;case MOUSEOVER:e===b&&f===c?clearTimeout(d.mouseoutTimer):(h.fireOut=!0,h.events.push(MOUSEOVER));break;case TOUCHEND:case MOUSEUP:d.hasTouchEvent=!1,h.events.push(MOUSEUP);break;case MOUSEOUT:if(isIE11&&!a.originalEvent.relatedTarget)return h;h.fireOut=!0;}return h}addEvents(){var a,b,c,d=this,e=d.getFromEnv('chart'),f=e.getChildren('canvas'),g=d.config.evtData,h=d.eventsList;for(e.config.enableMouseOutEvent&&h.push(MOUSEOUT),d._removeListners(),g.chart=e,g.mouseTracker=d,b=0;b<f.length;b++)for(c in a=f[b],h)a.addEventListener(h[c],d.handler)}_removeListners(){var a,b,c,d=this,e=d.getFromEnv('chart'),f=e.getChildren('canvas'),g=d.eventsList;for(c=0;c<f.length;c++)for(b in a=f[c],g)a.removeEventListener(g[b],d.handler);d._removeDocEvents()}_removeDocEvents(){this.eventOutput&&this.eventOutput.unlisten(),this.eventOutput=UNDEF}_dispose(){this._removeListners(),super._dispose()}}export default MouseTracker;