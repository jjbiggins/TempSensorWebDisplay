import{getArrayCopy,dashedAttr2CSSMap,loadRefImage,showRecursively}from'./raphael.lib';export default function(e){if(e.svg){var t={visibility:'hidden',"font-size":'0px'},n=String,r=parseFloat,a=parseInt,o={top:0,bottom:-1,middle:-.5},s=!!document.documentMode,i=Math,d=i.max,p=i.abs,l=i.pow,h=i.sqrt,c=/^xlink:/,g=/[, ]+/,f=/\n|<br\s*?\/?>/i,y=/&lt|&gt|<br/i,u=Array.prototype.shift,_=!!(/AppleWebKit/.test(e._g.win.navigator.userAgent)&&(!/Chrome/.test(e._g.win.navigator.userAgent)||29>e._g.win.navigator.appVersion.match(/Chrome\/(\d+)\./)[1])),m=e.eve,w=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),v={block:'M5,0 0,2.5 5,5z',classic:'M5,0 0,2.5 5,5 3.5,3 3.5,2z',diamond:'M2.5,0 5,2.5 2.5,5 0,2.5z',open:'M6,1 1,3.5 6,6',oval:'M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z'},x={speed:'optimizeSpeed',crisp:'crispEdges',precision:'geometricPrecision'},b=e._g.win.navigator.userAgent.toLowerCase(),k=function(){var e=-1!=b.indexOf('msie')&&parseInt(b.split('msie')[1]);return!!(e&&9===e)}(),C={},A=function(t,r,a,i){e._preload(a[1],function(){var e=this.offsetWidth,a=this.offsetHeight;B(t,{width:e,height:a}),B(r,{width:e,height:a}),i.safari()})},T=function(e,t){if(t)for(var r in t)e[r]=t[r]};e.cachedFontHeight={},e.toString=function(){return'Your browser supports SVG.\nYou are running Rapha\xEBl '+this.version},e._url='';var S=function(e,t){var r=e.gradient;if(r){if(r===t)return;r.refCount--,r.refCount||r.parentNode.removeChild(r),delete e.gradient}t&&(e.gradient=t,t.refCount++)},B=e._createNode=function(t,r){if('string'==typeof t&&(t=e._g.doc.createElementNS('http://www.w3.org/2000/svg',t)),r){var a,i;for(a in r)i=k?n(r[a]):r[a],c.test(a)?t.setAttributeNS('http://www.w3.org/1999/xlink',a.replace(c,''),i):t.setAttribute(a,i)}return t},L={userSpaceOnUse:'userSpaceOnUse',objectBoundingBox:'objectBoundingBox'},N={pad:'pad',redlect:'reflect',repeat:'repeat'},E=function(t,a){if(!t.paper||!t.paper.defs)return 0;var c,g,f,y,u,_,m='linear',w=t.paper,v=e.getElementID((w.id+'-'+a).replace(/[()\s%:,\xb0#]/g,'_')),x=.5,b=.5,k=t.node,o=k.style,s=e._g.doc.getElementById(v);if(!s){if(a=n(a).replace(e._radial_gradient,function(e,t){m='radial',t=t?t.split(','):[],y=t[5],u=t[6];var a,i,n=t[0],o=t[1],s=t[2],d=t[3],p=t[4],_=n&&o;return(s&&(c=/%/.test(s)?s:r(s)),y===L.userSpaceOnUse)?(_&&(x=n,b=o),d&&p&&(g=d,f=p,!_&&(x=g,b=f)),''):(_&&(x=r(n),b=r(o),a=2*(.5<b)-1,.25<(i=l(x-.5,2))+l(b-.5,2)&&.25>i&&(b=h(.25-i)*a+.5)&&.5!==b&&(b=b.toFixed(5)-1e-5*a)),d&&p&&(g=r(d),f=r(p),a=2*(.5<f)-1,.25<(i=l(g-.5,2))+l(f-.5,2)&&.25>i&&(f=h(.25-i)*a+.5)&&.5!==f&&(f=f.toFixed(5)-1e-5*a),!_&&(x=g,b=f)),'')}),a=a.split(/\s*-\s*/),'linear'==m){var C,A=a.shift(),T=A.match(/\((.*)\)/);if(T=T&&T[1]&&T[1].split(/\s*,\s*/),A=-r(A),isNaN(A))return null;T&&T.length?(T[0]in L?(y=T.shift(),T[0]in N&&(u=T.shift())):(T[4]&&(y=T[4]),T[5]&&(u=T[5])),_=[T[0]||'0%',T[1]||'0%',T[2]||'100%',T[3]||'0%']):(_=[0,0,i.cos(e.rad(A)),i.sin(e.rad(A))],C=1/(d(p(_[2]),p(_[3]))||1),_[2]*=C,_[3]*=C,0>_[2]&&(_[0]=-_[2],_[2]=0),0>_[3]&&(_[1]=-_[3],_[3]=0))}var E=e._parseDots(a);if(!E)return null;s=B(m+'Gradient',{id:v}),s.refCount=0,y in L&&s.setAttribute('gradientUnits',n(y)),u in N&&s.setAttribute('spreadMethod',n(u)),'radial'==m?(void 0!==c&&s.setAttribute('r',n(c)),void 0!==g&&void 0!==f&&(s.setAttribute('cx',n(g)),s.setAttribute('cy',n(f))),s.setAttribute('fx',n(x)),s.setAttribute('fy',n(b))):B(s,{x1:_[0],y1:_[1],x2:_[2],y2:_[3]});for(var P=0,O=E.length;P<O;P++)s.appendChild(B('stop',{offset:E[P].offset?E[P].offset:P?'100%':'0%',"stop-color":E[P].color||'#fff',"stop-opacity":void 0===E[P].opacity?1:E[P].opacity}));w.defs.appendChild(s)}return S(t,s),B(k,{fill:'url(\''+e._url+'#'+v+'\')',"fill-opacity":1}),o.fill='',1},P=function(e){var t=e.getBBox(1);B(e.pattern,{patternTransform:e.matrix.invert()+' translate('+t.x+','+t.y+')'})},O=function(r,a,o){if('path'==r.type){for(var s,d,l,c,g,f=n(a).toLowerCase().split('-'),y=r.paper,p=o?'end':'start',u=r.node,_=r.attrs,m=_['stroke-width'],x=f.length,b='classic',k=3,A=3,T=5;x--;)switch(f[x]){case'block':case'classic':case'oval':case'diamond':case'open':case'none':b=f[x];break;case'wide':A=5;break;case'narrow':A=2;break;case'long':k=5;break;case'short':k=2;}if('open'==b?(k+=2,A+=2,T+=2,l=1,c=o?4:1,g={fill:'none',stroke:_.stroke}):(c=l=k/2,g={fill:_.stroke,stroke:'none'}),r._.arrows?o?(r._.arrows.endPath&&C[r._.arrows.endPath]--,r._.arrows.endMarker&&C[r._.arrows.endMarker]--):(r._.arrows.startPath&&C[r._.arrows.startPath]--,r._.arrows.startMarker&&C[r._.arrows.startMarker]--):r._.arrows={},'none'!=b){var S='raphael-marker-'+b,L='raphael-marker-'+p+b+k+A+'-obj'+r.id;e._g.doc.getElementById(S)?C[S]++:(y.defs.appendChild(B(B('path'),{"stroke-linecap":'round',d:v[b],id:S})),C[S]=1);var N,E=e._g.doc.getElementById(L);E?(C[L]++,N=E.getElementsByTagName('use')[0]):(E=B(B('marker'),{id:L,markerHeight:A,markerWidth:k,orient:'auto',refX:c,refY:A/2}),N=B(B('use'),{"xlink:href":'#'+S,transform:(o?'rotate(180 '+k/2+' '+A/2+') ':'')+'scale('+k/T+','+A/T+')',"stroke-width":(1/((k/T+A/T)/2)).toFixed(4)}),E.appendChild(N),y.defs.appendChild(E),C[L]=1),B(N,g);var P=l*('diamond'!=b&&'oval'!=b);o?(s=r._.arrows.startdx*m||0,d=e.getTotalLength(_.path)-P*m):(s=P*m,d=e.getTotalLength(_.path)-(r._.arrows.enddx*m||0)),g={},g['marker-'+p]='url(\''+e._url+'#'+L+'\')',(d||s)&&(g.d=e.getSubpath(_.path,s,d)),B(u,g),r._.arrows[p+'Path']=S,r._.arrows[p+'Marker']=L,r._.arrows[p+'dx']=P,r._.arrows[p+'Type']=b,r._.arrows[p+'String']=a}else o?(s=r._.arrows.startdx*m||0,d=e.getTotalLength(_.path)-s):(s=0,d=e.getTotalLength(_.path)-(r._.arrows.enddx*m||0)),r._.arrows[p+'Path']&&B(u,{d:e.getSubpath(_.path,s,d)}),delete r._.arrows[p+'Path'],delete r._.arrows[p+'Marker'],delete r._.arrows[p+'dx'],delete r._.arrows[p+'Type'],delete r._.arrows[p+'String'];for(g in C)if(C.hasOwnProperty(g)&&!C[g]){var O=e._g.doc.getElementById(g);O&&O.parentNode.removeChild(O)}}},z={"":['none'],none:['none'],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},M=function(t,r,a){if(void 0!==r){var n,o,s,d,p,l=z[r.toLowerCase&&r.toLowerCase()];if(r=l||[].concat(r),e.is(r,'array')){if(o=a['stroke-width']||t.attrs['stroke-width']||1,s={round:o,square:o,butt:0}[a['stroke-linecap']||t.attrs['stroke-linecap']]||0,d=r.length,p=l?o:1,'none'===r[0])n=r;else for(n=[];d--;)n[d]=r[d]*p+(d%2?1:-1)*s,0>=n[d]&&(n[d]=.01+(1>=o?s:0)),isNaN(n[d])&&(n[d]=0);return{"stroke-dasharray":n.join(',')}}}},I=e._setFillAndStroke=function(t,r){if(t.paper.canvas){var i,o,s,l,h,c,f=t.node,y=t.attrs,u=t.paper,m={},w={};for(o in'image'===t.type&&loadRefImage(t,r),r)if(o in e._availableAttrs)if(s=r[o],''===s&&o in y)delete y[o],f.removeAttribute('src'===o?'href':o);else switch(y[o]=s,o){case'blur':t.blur(s);break;case'href':case'title':case'target':var v=f.parentNode;if('a'!==v.tagName.toLowerCase()){if(''===s)break;var b=B('a');b.raphael=!0,b.raphaelid=f.raphaelid,v.insertBefore(b,f),b.appendChild(f),v=b}'target'===o?v.setAttributeNS('http://www.w3.org/1999/xlink','show','blank'===s?'new':s):v.setAttributeNS('http://www.w3.org/1999/xlink',o,s),f.titleNode=v;break;case'cursor':w.cursor=s;break;case'transform':t.transform(s);break;case'rotation':e.is(s,'array')?t.rotate.apply(t,s):t.rotate(s);break;case'arrow-start':O(t,s);break;case'arrow-end':O(t,s,1);break;case'clip-path':l=!0;case'clip-rect':if(c=!l&&n(s).split(g),t._.clipispath=!!l,l||4===c.length){t.clip&&t.clip.parentNode.parentNode.removeChild(t.clip.parentNode);var k=B(l?'path':'rect');i=B('clipPath'),i.id=e.getElementID(e.createUUID()),B(k,l?{d:s?y['clip-path']=e._pathToAbsolute(s):e._availableAttrs.path,fill:'none'}:{x:c[0],y:c[1],width:c[2],height:c[3],transform:t.matrix.invert()}),i.appendChild(k),u.defs.appendChild(i),m['clip-path']='url(\''+e._url+'#'+i.id+'\')',t.clip=k}if(!s){var C=f.getAttribute('clip-path');if(C){var L=e._g.doc.getElementById(C.replace(/(^url\(#|\)$)/g,''));L&&L.parentNode.removeChild(L),m['clip-path']='',11===document.documentMode&&f.removeAttribute('clip-path'),delete t.clip}}break;case'path':'path'===t.type&&(m.d=s?y.path=e._stopabsolutePath?e.sanitizePath(s):e._pathToAbsolute(s):e._availableAttrs.path,t._.dirty=1,t._.arrows&&('startString'in t._.arrows&&O(t,t._.arrows.startString),'endString'in t._.arrows&&O(t,t._.arrows.endString,1)));break;case'width':if(m[o]=s,t._.dirty=1,y.fx)o='x',s=y.x;else break;case'x':y.fx&&(s=-y.x-(y.width||0));case'rx':if('rx'===o&&'rect'===t.type)break;case'cx':m[o]=s,t.pattern&&P(t),t._.dirty=1;break;case'height':if(m[o]=s,t._.dirty=1,y.fy)o='y',s=y.y;else break;case'y':if('text'===t.type)break;y.fy&&(s=-y.y-(y.height||0));case'ry':if('ry'===o&&'rect'===t.type)break;case'cy':m[o]=s,t.pattern&&P(t),t._.dirty=1;break;case'r':'rect'===t.type?m.rx=m.ry=s:m[o]=s,t._.dirty=1;break;case'src':'image'===t.type&&f.setAttributeNS('http://www.w3.org/1999/xlink','href',s);break;case'stroke-width':(1!==t._.sx||1!==t._.sy)&&(s/=d(p(t._.sx),p(t._.sy))||1),u._vbSize&&(s*=u._vbSize),_&&0===s&&(s=1e-6),m[o]=s,!r['stroke-dasharray']&&y['stroke-dasharray']&&T(m,M(t,y['stroke-dasharray'],r)),t._.arrows&&('startString'in t._.arrows&&e.addArrow&&e.addArrow(t,t._.arrows.startString),'endString'in t._.arrows&&e.addArrow&&e.addArrow(t,t._.arrows.endString,1));break;case'stroke-dasharray':T(m,M(t,s,r));break;case'fill':var N=e._ISURL.test(s);if(N){h=s.split(e._ISURL),i=B('pattern');var z=B('image');i.id=e.getElementID(e.createUUID()),B(i,{x:0,y:0,patternUnits:'userSpaceOnUse',height:1,width:1}),B(z,{x:0,y:0,"xlink:href":h[1]}),i.appendChild(z),A(i,z,h,u),u.defs.appendChild(i),m.fill='url(\''+e._url+h[1]+'\')',t.pattern=i,t.pattern&&P(t);break}var I=e.getRGB(s);if(!I.error)delete r.gradient,delete y.gradient,!e.is(y['fill-opacity'],'undefined')&&e.is(r['fill-opacity'],'undefined')&&(m['fill-opacity']=y['fill-opacity']),t.gradient&&S(t);else if(('circle'===t.type||'ellipse'===t.type||'r'!==n(s).charAt())&&E(t,s)){y.gradient=s;break}I.hasOwnProperty('opacity')?(m['fill-opacity']=1<I.opacity?I.opacity/100:I.opacity,t._.fillOpacityDirty=!0):t._.fillOpacityDirty&&e.is(y['fill-opacity'],'undefined')&&e.is(r['fill-opacity'],'undefined')&&(f.removeAttribute('fill-opacity'),delete t._.fillOpacityDirty);case'stroke':I=e.getRGB(s),m[o]=I.hex,'stroke'===o&&(I.hasOwnProperty('opacity')?(m['stroke-opacity']=1<I.opacity?I.opacity/100:I.opacity,t._.strokeOpacityDirty=!0):t._.strokeOpacityDirty&&e.is(y['stroke-opacity'],'undefined')&&e.is(r['stroke-opacity'],'undefined')&&(f.removeAttribute('stroke-opacity'),delete t._.strokeOpacityDirty),t._.arrows&&('startString'in t._.arrows&&O(t,t._.arrows.startString),'endString'in t._.arrows&&O(t,t._.arrows.endString,1)));break;case'gradient':('circle'===t.type||'ellipse'===t.type||'r'!==n(s).charAt())&&E(t,s);break;case'visibility':'hidden'===s?t.hide():t.show();break;case'opacity':s=1<s?s/100:s,m.opacity=s;break;case'fill-opacity':s=1<s?s/100:s,m['fill-opacity']=s;break;case'shape-rendering':t.attrs[o]=s=x[s]||s||'auto',m[o]=s,f.style.shapeRendering=s;break;case'line-height':case'vertical-align':break;default:'font-size'===o&&(s=a(s,10)+'px'),t._.dirty=1,m[o]=s,dashedAttr2CSSMap[o]&&(w[dashedAttr2CSSMap[o]]=s);}for(o in w)f.style[o]=w[o];for(o in m)f.setAttribute(o,m[o]);'text'!==t.type||r['_do-not-tune']||R(t,r)}},D=e._updateFollowers=function(){var e,t,r,a=getArrayCopy(arguments),n=u.call(a),o=u.call(a);for(e=0,t=n.followers.length;e<t;e++)r=n.followers[e].el,r[o].apply(r,a)},R=function(d,p){if('text'===d.type&&(p.hasOwnProperty('text')||p.hasOwnProperty('font')||p.hasOwnProperty('font-size')||p.hasOwnProperty('x')||p.hasOwnProperty('y')||p.hasOwnProperty('line-height')||p.hasOwnProperty('vertical-align'))){var h,c,g,u,_,m,w,v,x,b,k,C=d.attrs,a=d.parent,A=d.node,T=d._oldAttr=d._oldAttr||{baseLineDiff:8,valign:-.5},S=r(p['line-height']||C['line-height']),L=p.direction||C.direction||a&&a.attrs&&a.attrs.direction||T.direction||'initial',N=!1,E=!1,P=s||'rtl'!==L?1:2,O=!1,z=!1,M=!s&&T.direction&&L!==T.direction;if(T.direction=L,S||(h=p.fontSize||p['font-size']||C['font-size']||a&&a.attrs&&a.attrs.fontSize,h=h?h.toString().replace('px',''):10,S=h*1.2),p.hasOwnProperty('text')&&(k=e.is(p.text,'array')?p.text.join('<br>'):p.text,k!==T.text&&(z=!0,k&&y.test(k)&&(k=k.replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&<br\/>lt;|&l<br\/>t;|&lt<br\/>;/g,'<<br/>').replace(/&<br\/>gt;|&g<br\/>t;|&gt<br\/>;/g,'><br/>')),T.text=C.text=k,f.test(k)?(T.noTSpan&&(T.noTSpan=!(M=!0)),w=n(k).split(f),_=w.length):(M=!0,T.noTSpan=!0,_=1),T.lineCount!==_&&(T.lineCount=_,O=!0))),S!==T.lineHeight&&(T.lineHeight=S,T.baseLineDiff=.75*S,O=!0),M)for(;A.firstChild;)A.removeChild(A.firstChild);if(!(1<T.lineCount))z&&A.appendChild(e._g.doc.createTextNode(k));else if(g={},T.tspanAttr||(T.tspanAttr={},T.tspan0Attr={}),T.tspanAttr.dy!==T.lineHeight&&(T.tspanAttr.dy=g.dy=T.lineHeight,E=!0),p.hasOwnProperty('x')&&T.tspanAttr.x!==p.x&&(T.tspan0Attr.x=T.tspanAttr.x=g.x=C.x,E=!0),z){for(b=A.getElementsByTagName('tspan'),u=0;u<_;u++){if(x=b[u*P],x){if(x.innerHTML='',s)for(;x.firstChild;)x.removeChild(x.firstChild);E&&B(x,u?g:T.tspan0Attr)}else x=B('tspan',u?T.tspanAttr:T.tspan0Attr),A.appendChild(x),s||'rtl'!==L||(v=B('tspan',t),v.appendChild(e._g.doc.createTextNode('i')),A.appendChild(v));w[u]||(x.setAttributeNS('http://www.w3.org/XML/1998/namespace','xml:space','preserve'),w[u]=' '),x.appendChild(e._g.doc.createTextNode(w[u]))}if(m=_*P,b.length>m)for(u=b.length-1;u>=m;u-=1)A.removeChild(b[u])}else if(E)for(b=A.getElementsByTagName('tspan'),m=b.length,u=0;u<m;u+=P)B(b[u],u?g:T.tspan0Attr);p['vertical-align']&&(c=o[C['vertical-align']]||0,c!==T.valign&&(T.valign=c,O=!0)),O&&(T.shift=T.baseLineDiff+T.lineCount*T.lineHeight*T.valign,N=!0),(p.y||0===p.y)&&T.y!==p.y&&(T.y=C.y,N=!0),N&&B(A,{y:Math.round(T.y+T.shift)})}},U=function(t,r,a){var i=this,n=a||r;n.canvas&&n.canvas.appendChild(t),i.node=i[0]=t,t.raphael=!0,t.raphaelid=i.id=e._oid++,i.matrix=e.matrix(),i.realPath=null,i.attrs=i.attrs||{},i.followers=i.followers||[],i.paper=r,i.ca=i.customAttributes=i.customAttributes||new r._CustomAttributes,i._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},i.parent=n,n.bottom||(n.bottom=i),i.prev=n.top,n.top&&(n.top.next=i),n.top=i,i.next=null},F=e.el;U.prototype=F,F.constructor=U,e._engine.getNode=function(e){var t=e.node||e[0].node;return t.titleNode||t},e._engine.getLastNode=function(e){var t=e.node||e[e.length-1].node;return t.titleNode||t},F.rotate=function(e,t,a){var i,s=this;return s.removed?s:(D(s,'rotate',e,t,a),e=n(e).split(g),e.length-1&&(t=r(e[1]),a=r(e[2])),e=r(e[0]),null==a&&(t=a),(null==t||null==a)&&(i=s.getBBox(1),t=i.x+i.width/2,a=i.y+i.height/2),s.transform(s._.transform.concat([['r',e,t,a]])),s)},F.scale=function(e,t,a,i){var s,d=this;return d.removed?d:(D(d,'scale',e,t,a,i),e=n(e).split(g),e.length-1&&(t=r(e[1]),a=r(e[2]),i=r(e[3])),e=r(e[0]),null==t&&(t=e),null==i&&(a=i),(null==a||null==i)&&(s=d.getBBox(1)),a=null==a?s.x+s.width/2:a,i=null==i?s.y+s.height/2:i,d.transform(d._.transform.concat([['s',e,t,a,i]])),d)},F.translate=function(e,t){var a=this;return a.removed?a:(D(a,'translate',e,t),e=n(e).split(g),e.length-1&&(t=r(e[1])),e=r(e[0])||0,t=+t||0,a.transform(a._.transform.concat([['t',e,t]])),a)},F.transform=function(t){var r,a=this,i=a._;return null==t?i.transform:(e._extractTransform(a,t),a.clip&&!i.clipispath&&B(a.clip,{transform:a.matrix.invert()}),a.pattern&&P(a),a.node&&B(a.node,{transform:a.matrix}),(1!==i.sx||1!==i.sy)&&(r=a.attrs['stroke-width'],r&&a.attr({"stroke-width":r})),a)},F.hide=function(){var e=this;return D(e,'hide'),e.removed||e.paper.safari(e.node.style.display='none'),e},F.show=function(){var e=this;return D(e,'show'),e.removed||e.paper.safari(e.node.style.display=''),e},F.remove=function(){if(!this.removed&&this.parent.canvas){var t,r=this,a=e._engine.getNode(r),n=r.paper,o=n.defs;for(n.__set__&&n.__set__.exclude(r),m.unbind('raphael.*.*.'+r.id),r.gradient&&o&&S(r);t=r.followers.pop();)t.el.remove();for(;t=r.bottom;)t.remove();if(r._drag&&r.undrag(),r.events)for(;t=r.events.pop();)t.unbind();for(t in r.parent.canvas.contains(a)&&r.parent.canvas.removeChild(a),r.removeData(),delete n._elementsById[r.id],e._tear(r,r.parent),r)r[t]='function'==typeof r[t]?e._removedFactory(t):null;r.removed=!0}},F._getBBox=function(){var e,t,r,i=this,n=i.node,o={},d=i.attrs,a='text'===i.type;s&&a?e=showRecursively(i):'none'===n.style.display&&(i.show(),r=!0);try{o=n.getBBox(),a&&(void 0===o.x&&(o.isCalculated=!0,t=d['text-anchor'],o.x=(d.x||0)-o.width*('start'===t?0:'middle'===t?.5:1)),void 0===o.y&&(o.isCalculated=!0,t=d['vertical-align'],o.y=(d.y||0)-o.height*('bottom'===t?1:'middle'===t?.5:0)))}catch(t){}finally{o=o||{}}return s&&a?e&&e():r&&i.hide(),o},F.attr=function(t,r){if(this.removed)return this;var a,n,o,s,d,p,l,h,c=this,g=this.attrs,f={},y=c._invokedCa||(c._invokedCa={}),u=this.ca;if(null==t){var _={};for(a in g)g.hasOwnProperty(a)&&(_[a]=g[a]);return _.gradient&&'none'===_.fill&&(_.fill=_.gradient)&&delete _.gradient,_.transform=this._.transform,_.visibility='none'===this.node.style.display?'hidden':'visible',_}if(null!=r)s={},s[t]=r;else if(e.is(t,'object'))s=t;else if(e.is(t,'string'))return'fill'===t&&'none'===g.fill&&g.gradient?g.gradient:'transform'===t?this._.transform:'visibility'===t?'none'===this.node.style.display?'hidden':'visible':t in g?g[t]:e.is(u[t],'function')?u[t].def:e._availableAttrs[t];if(!e.stopPartialEventPropagation)for(a in s)m('raphael.attr.'+a+'.'+this.id,this,s[a],a);for(a in s)if(h=u[a],h&&!y[a]&&e.is(h,'function')){for(d in y[a]=!0,p=h.apply(this,[].concat(s[a])),y[a]=!1,p)f[d]=p[d];g[a]=s[a]}else f[a]=s[a];for(I(this,f),n=0,o=this.followers.length;n<o;n++)l=this.followers[n],l.cb&&!l.cb.call(l.el,f,this)||l.el.attr(f);return this},F.on=function(t,r,a){var i,n,o,s=this;return this.removed?this:'dragstart'===t?(this.drag(null,r),this):'dragmove'===t?(this.drag(r),this):'dragend'===t?(this.drag(null,null,r),this):(n=r,o=t,e.supportsTouch&&!a&&(t=e._touchMap[t]||'click'===t&&'touchend'||t,t!==o&&(!s._tempTouchListeners&&(s._tempTouchListeners={}),!s._tempTouchListeners[o]&&(s._tempTouchListeners[o]=[]),n=function(t){t.preventDefault(),r(t)},s._tempTouchListeners[o].push({oldFn:r,newFn:n,newEvt:t}),!w&&s.on(o,r,!0))),this._&&this._.RefImg&&('load'===t||'error'===t)?(i=this._.RefImg,n=function(t){s.removed||r.call(s,t)}):i=this.node,i.addEventListener?i.addEventListener(t,n):i['on'+t]=n,this)},F.off=function(t,r,a){var n,o,s,d,p,h=this;if(this.removed)return this;if('dragstart'===t)return h.undragstart(r),this;if('dragmove'===t)return this.undragmove(r),this;if('dragend'===t)return this.undragend(r),this;if(n=r,p=t,!a&&e.supportsTouch&&h._tempTouchListeners&&h._tempTouchListeners[p]){for(s=h._tempTouchListeners[p].length,o=0;o<s&&p===t;o+=1)h._tempTouchListeners[p][o]&&h._tempTouchListeners[p][o].oldFn===n&&(t=h._tempTouchListeners[p][o].newEvt,n=h._tempTouchListeners[p][o].newFn,h._tempTouchListeners[p].splice(o,1));w||h.off(p,r,!0)}return d=this._&&this._.RefImg?this._.RefImg:this.node,d.removeEventListener?d.removeEventListener(t,n):d['on'+t]=null,this},e._engine.path=function(e,t,r){var a=B('path'),i=new U(a,e,r);return i.type='path',t&&i.attr(t),i},e._engine.group=function(e,t,r){var a=B('g'),i=new U(a,e,r);return i.type='group',i.canvas=i.node,i.top=i.bottom=null,i._id=t||'',t&&a.setAttribute('class','raphael-group-'+i.id+'-'+t),i},e._engine.circle=function(e,t,r){var a=B('circle'),i=new U(a,e,r);return i.type='circle',t&&i.attr(t),i},e._engine.rect=function(e,t,r){var a=B('rect'),i=new U(a,e,r);return i.type='rect',t.rx=t.ry=t.r,t&&i.attr(t),i},e._engine.ellipse=function(e,t,r){var a=B('ellipse'),i=new U(a,e,r);return i.type='ellipse',t&&i.attr(t),i},e._engine.image=function(e,t,r){var a=B('image'),i=new U(a,e,r,!0);return i._.group=r||e,i.type='image',a.setAttribute('preserveAspectRatio','none'),t&&i.attr(t),i},e._engine.text=function(e,t,r,a){var i=B('text'),n=new U(i,e,r);return n.type='text',a&&n.css&&n.css(a,void 0,!0),t&&n.attr(t),n},e._engine.setSize=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas.setAttribute('width',this.width),this.canvas.setAttribute('height',this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},e._engine.create=function(){var t,r=e._getContainer.apply(0,arguments),a=r&&r.container,i=r.x,n=r.y,o=r.width,s=r.height;if(!a)throw new Error('SVG container not found.');var d,p=B('svg');return i=i||0,n=n||0,o=o||512,s=s||342,B(p,{height:s,version:1.1,width:o,xmlns:'http://www.w3.org/2000/svg'}),1===a?(p.style.cssText='overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-user-select:none;-moz-user-select:-moz-none;-khtml-user-select:none;-ms-user-select:none;user-select:none;-o-user-select:none;cursor:default;vertical-align:middle;position:absolute;left:'+i+'px;top:'+n+'px',a=e._g.doc.body,a.appendChild(p),d=1):(p.style.cssText='overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-user-select:none;-moz-user-select:-moz-none;-khtml-user-select:none;-ms-user-select:none;user-select:none;-o-user-select:none;cursor:default;vertical-align:middle;position:relative',a.firstChild?a.insertBefore(p,a.firstChild):a.appendChild(p)),t=new e._Paper,t.width=o,t.height=s,t.canvas=p,t.container=a,B(p,{id:'raphael-paper-'+t.id}),t.clear(),t._left=t._top=0,d&&(t.renderfix=function(){}),t.renderfix(),t},e._engine.setViewBox=function(e,t,r,a,i){m('raphael.setViewBox',this,this._viewBox,[e,t,r,a,i]);var n,o,s=d(r/this.width,a/this.height),p=this.top,l=i?'meet':'xMinYMin';if(null==e?(this._vbSize&&(s=1),delete this._vbSize,n='0 0 '+this.width+' '+this.height):(this._vbSize=s,n=e+' '+t+' '+r+' '+a),B(this.canvas,{viewBox:n,preserveAspectRatio:l}),s)for(;p;)o='stroke-width'in p.attrs?p.attrs['stroke-width']:1,p.attr({"stroke-width":o}),p._.dirty=1,p._.dirtyT=1,p=p.prev;return this._viewBox=[e,t,r,a,!!i],this},e.prototype.detachPaper=function(){!1!==this._detached&&(this.container.removeChild(this.canvas),this._detached=!0)},e.prototype.attachPaper=function(){this._detached&&(this.container.appendChild(this.canvas),this._detached=!1)},e.prototype.renderfix=function(){var e,t=this.canvas,r=t.style;try{e=t.getScreenCTM()||t.createSVGMatrix()}catch(r){e=t.createSVGMatrix()}var a=-e.e%1,i=-e.f%1;(a||i)&&(a&&(this._left=(this._left+a)%1,r.left=this._left+'px'),i&&(this._top=(this._top+i)%1,r.top=this._top+'px'))},e.prototype._desc=function(t){var r=this.desc;if(!r)this.desc=r=B('desc'),this.canvas.appendChild(r);else for(;r.firstChild;)r.removeChild(r.firstChild);r.appendChild(e._g.doc.createTextNode(e.is(t,'string')?t:'Created with Red Rapha\xEBl '+e.version))},e.prototype.clear=function(){var e;for(m('raphael.clear',this);e=this.bottom;)e.remove();for(e=this.canvas;e.firstChild;)e.removeChild(e.firstChild);this.bottom=this.top=null,e.appendChild(this.desc=B('desc')),e.appendChild(this.defs=B('defs'))},e.prototype.remove=function(){for(m('raphael.remove',this);t=this.bottom;)t.remove();for(var t in this.defs&&this.defs.parentNode.removeChild(this.defs),this.desc&&this.desc.parentNode.removeChild(this.desc),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[t]='function'==typeof this[t]?e._removedFactory(t):null;this.removed=!0},e.prototype.setHTMLClassName=function(){}}}